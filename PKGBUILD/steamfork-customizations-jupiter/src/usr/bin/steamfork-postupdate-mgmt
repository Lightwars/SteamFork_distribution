#!/bin/bash

UPDATE_STAMP="/etc/post-update.last"
source /etc/os-release
if [ -e "${UPDATE_STAMP}" ]
then
  LAST_UPDATE="$(cat ${UPDATE_STAMP})"
fi

if [ ! "${LAST_UPDATE}" = "${BUILD_ID}" ]
then
  steamos-readonly disable >/var/log/update.log 2>&1
  if [ -d "/etc/post-update.d" ]
  then
    for UPDATE in /etc/post-update.d/*
    do
      ${UPDATE} >>/var/log/update.log 2>&1
    done
  fi
  steamos-readonly enable >>/var/log/update.log 2>&1
  echo "${BUILD_ID}" >${UPDATE_STAMP}
fi
exit 0
